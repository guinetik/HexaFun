<!DOCTYPE html>


<!--
 | Generated by Apache Maven Doxia Site Renderer 2.0.0-M16 from src/site/markdown/adapters.md
 | Rendered using Apache Maven Fluido Skin 2.0.0-M8
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 2.0.0-M16" />
    <title>HexaFun – Adapters: One Domain, Many Faces</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-2.0.0-M8.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
    <script src="./js/apache-maven-fluido-2.0.0-M8.min.js"></script>
<!-- Google Analytics 4 -->
                <script async src="https://www.googletagmanager.com/gtag/js?id=G-9J979FF4TK"></script>
                <script>
                    window.dataLayer = window.dataLayer || [];
                    function gtag(){dataLayer.push(arguments);}
                    gtag('js', new Date());
                    gtag('config', 'G-9J979FF4TK');
                </script>
                <!-- SEO Meta Tags -->
                <meta name="description" content="HexaFun - A lightweight, functional approach to Hexagonal Architecture in Java. Fluent DSL for ports, adapters, and use cases with zero dependencies." />
                <meta name="keywords" content="hexagonal architecture, ports and adapters, java, clean architecture, domain driven design, ddd, functional programming, fluent api, use cases" />
                <meta name="author" content="guinetik" />

                <!-- Open Graph / Facebook -->
                <meta property="og:type" content="website" />
                <meta property="og:url" content="https://hexafun.guinetik.com/" />
                <meta property="og:title" content="HexaFun - Functional Patterns for Hexagonal Architecture" />
                <meta property="og:description" content="A lightweight, functional approach to Hexagonal Architecture in Java. Fluent DSL for ports, adapters, and use cases with zero dependencies." />
                <meta property="og:image" content="https://hexafun.guinetik.com/images/og-image.png" />

                <!-- Twitter/X Card -->
                <meta name="twitter:card" content="summary_large_image" />
                <meta name="twitter:site" content="@guinetik" />
                <meta name="twitter:creator" content="@guinetik" />
                <meta name="twitter:title" content="HexaFun - Hexagonal Architecture for Java" />
                <meta name="twitter:description" content="A lightweight, functional approach to Hexagonal Architecture in Java." />
                <meta name="twitter:image" content="https://hexafun.guinetik.com/images/og-image.png" />
                <meta name="twitter:image:alt" content="HexaFun logo and architecture diagram" />

                <!-- Threads/Instagram (uses OG tags above) -->
                <!-- Additional OG tags for broader compatibility -->
                <meta property="og:site_name" content="HexaFun" />
                <meta property="og:image:width" content="1200" />
                <meta property="og:image:height" content="630" />
                <meta property="og:image:type" content="image/png" />

                <!-- Favicon -->
                <link rel="icon" type="image/svg+xml" href="./images/favicon.svg" />
                <link rel="icon" type="image/png" sizes="32x32" href="./images/favicon-32x32.png" />
                <link rel="icon" type="image/png" sizes="16x16" href="./images/favicon-16x16.png" />
  
<!-- <!-- terminal-javadocs-injected [site] -->
<link rel="stylesheet" href="./terminal-styles/terminaljavadocs-site.min.css">
<script src="./terminal-styles/terminaljavadocs.min.js" defer></script>
</head>
  <body class="topBarEnabled">
    <header id="topbar" class="navbar navbar-fixed-top navbar-dark">
      <div class="navbar-inner">
            <div class="container">
              <a data-target=".nav-collapse" data-toggle="collapse" class="btn btn-navbar">
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
              </a>
          <nav class="nav-collapse">
<a class="brand" href="index.html"><img src="./images/logo.svg" alt="HexaFun" />
</a>
            <ul class="nav">
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Overview <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="index.html">Introduction</a></li>
            <li><a href="tutorial.html">Hexagonal Architecture Tutorial</a></li>
            <li><a>Adapters</a></li>
            <li><a href="fluent.html">Fluent DSL</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Documentation <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="apidocs/index.html">Javadoc</a></li>
            <li><a href="source-xref.html">Source Code (XRef)</a></li>
            <li><a href="coverage.html">Code Coverage</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Project Information <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li class="dropdown-submenu">
<a href="project-info.html">Project Information</a>
              <ul class="dropdown-menu">
                  <li><a href="index.html">About</a></li>
                  <li><a href="summary.html">Summary</a></li>
                  <li><a href="modules.html">Project Modules</a></li>
                  <li><a href="licenses.html">Licenses</a></li>
              </ul>
            </li>
            <li class="dropdown-submenu">
<a href="project-reports.html">Project Reports</a>
              <ul class="dropdown-menu">
                  <li><a href="apidocs/index.html">Javadoc</a></li>
                  <li><a href="testapidocs/index.html">Test Javadoc</a></li>
              </ul>
            </li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Links <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="./">GitHub</a></li>
            <li><a href="issues">Issues</a></li>
        </ul>
      </li>
            </ul>
          </nav>
          <div class="nav-collapse">
    <ul class="nav pull-right" style="border:none; margin-top: 7px"><li>
    <a href="https://twitter.com/guinetik" class="twitter-follow-button" data-show-count="true" data-align="right" data-size="large" data-show-screen-name="true" data-lang="en" data-dnt="true" >Follow guinetik</a>
    <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
    </li></ul>
          </div>
        </div>
      </div>
    </header>
    <div class="container container-top">
      <header>
        <div id="banner">
          <div class="pull-left"></div>
          <div class="pull-right"></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2025-12-16<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 1.0.1<span class="divider">|</span></li>
      <li><a href="index.html">HexaFun</a><span class="divider">/</span></li>
    <li class="active">Adapters: One Domain, Many Faces</li>
          </ul>
        </div>
      </header>
        <main id="bodyColumn">
<section>
<h1>Adapters: One Domain, Many Faces</h1>
<p>This guide shows how HexaFun's adapter pattern lets you transform domain objects
into multiple output formats without changing your business logic. We'll build a
system monitor that outputs the same metrics as colorful TUI gauges, plain text,
JSON, and Prometheus format.</p>
<script src="https://asciinema.org/a/762262.js" id="asciicast-762262" async="true"></script>
<hr /><section>
<h2>What Are Adapters?</h2>
<p>In hexagonal architecture, <strong>adapters</strong> bridge your domain and the outside world:</p>
<table class="table table-striped">
<thead>
<tr class="a">
<th>Type</th>
<th>Direction</th>
<th>Example</th></tr></thead><tbody>
<tr class="b">
<td><strong>Driving Adapter</strong></td>
<td>Outside &#x2192; Domain</td>
<td>REST controller, CLI, TUI</td></tr>
<tr class="a">
<td><strong>Driven Adapter</strong></td>
<td>Domain &#x2192; Outside</td>
<td>Database repository, HTTP client</td></tr>
<tr class="b">
<td><strong>Output Adapter</strong></td>
<td>Domain &#x2192; Presentation</td>
<td>JSON formatter, CSV exporter</td></tr></tbody>
</table>

<p>HexaFun's <code>AdapterKey</code> system focuses on <strong>output adapters</strong> - pure functions that
transform domain objects into presentation formats. The domain stays clean;
adapters handle the mess.</p><hr /></section><section>
<h2>The Problem</h2>
<p>Imagine a monitoring system that tracks CPU, memory, and disk usage. Different
consumers need different formats:</p>
<ul>

<li><strong>Operators</strong>: Colorful TUI with progress bars and warning indicators</li>
<li><strong>Scripts</strong>: Plain <code>key: value</code> pairs for parsing</li>
<li><strong>APIs</strong>: JSON for REST endpoints</li>
<li><strong>Monitoring</strong>: Prometheus exposition format for Grafana</li>
</ul>
<p>Without adapters, you'd either:</p>
<ol style="list-style-type: decimal;">

<li>Bloat your domain with formatting logic</li>
<li>Duplicate transformation code everywhere</li>
<li>Create tight coupling between domain and presentation</li>
</ol><hr /></section><section>
<h2>Part 1: The Domain Model</h2>
<p>Start with a clean domain record that knows nothing about presentation:</p>

<div class="verbatim">
<pre><code class="language-java">public record SystemMetrics(double cpu, double memory, double disk) {

    public static final double WARNING_THRESHOLD = 80.0;

    public boolean cpuWarning() {
        return cpu &gt;= WARNING_THRESHOLD;
    }

    public boolean memoryWarning() {
        return memory &gt;= WARNING_THRESHOLD;
    }

    public boolean diskWarning() {
        return disk &gt;= WARNING_THRESHOLD;
    }

    public boolean hasWarnings() {
        return cpuWarning() || memoryWarning() || diskWarning();
    }
}
</code></pre></div>
<p>Key design choices:</p>
<ul>

<li><strong>Pure data</strong> - No formatting, no I/O</li>
<li><strong>Domain behavior</strong> - <code>WARNING_THRESHOLD</code> is business logic, not presentation</li>
<li><strong>Immutable record</strong> - Thread-safe, predictable</li>
</ul><hr /></section><section>
<h2>Part 2: Type-Safe Adapter Keys</h2>
<p>Just like <code>UseCaseKey</code> for use cases, <code>AdapterKey</code> provides type-safe identifiers:</p>

<div class="verbatim">
<pre><code class="language-java">public final class SysmonKeys {

    // Use Case Keys - what the app does
    public static final UseCaseKey&lt;Void, SystemMetrics&gt; GET_ALL =
        UseCaseKey.of(&quot;getAllMetrics&quot;);

    // Adapter Keys - how output is formatted
    public static final AdapterKey&lt;SystemMetrics, String&gt; TO_TUI =
        AdapterKey.of(&quot;toTui&quot;);

    public static final AdapterKey&lt;SystemMetrics, String&gt; TO_CLI =
        AdapterKey.of(&quot;toCli&quot;);

    public static final AdapterKey&lt;SystemMetrics, String&gt; TO_JSON =
        AdapterKey.of(&quot;toJson&quot;);

    public static final AdapterKey&lt;SystemMetrics, String&gt; TO_PROMETHEUS =
        AdapterKey.of(&quot;toPrometheus&quot;);
}
</code></pre></div>
<p>Each <code>AdapterKey&lt;I, O&gt;</code> captures:</p>
<ul>

<li><strong>Input type</strong> - The domain object to transform (<code>SystemMetrics</code>)</li>
<li><strong>Output type</strong> - The result format (<code>String</code> in this case)</li>
<li><strong>Name</strong> - For debugging and logging</li>
</ul><hr /></section><section>
<h2>Part 3: Implementing Adapters</h2>
<p>Adapters are just <code>Function&lt;I, O&gt;</code> - pure transformations:</p><section>
<h3>TUI Adapter - Colorful Gauges</h3>

<div class="verbatim">
<pre><code class="language-java">public static final Function&lt;SystemMetrics, String&gt; TUI_ADAPTER = metrics -&gt; {
    StringBuilder sb = new StringBuilder();

    // Header with box drawing
    sb.append(color(&quot;&#x250c;&#x2500; System Monitor &#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;&quot;, CYAN)).append(&quot;\n&quot;);

    // CPU gauge
    sb.append(color(&quot;&#x2502;&quot;, CYAN))
      .append(gauge(&quot;CPU &quot;, metrics.cpu(), metrics.cpuWarning()))
      .append(color(&quot;&#x2502;&quot;, CYAN)).append(&quot;\n&quot;);

    // Memory gauge
    sb.append(color(&quot;&#x2502;&quot;, CYAN))
      .append(gauge(&quot;MEM &quot;, metrics.memory(), metrics.memoryWarning()))
      .append(color(&quot;&#x2502;&quot;, CYAN)).append(&quot;\n&quot;);

    // Disk gauge
    sb.append(color(&quot;&#x2502;&quot;, CYAN))
      .append(gauge(&quot;DISK&quot;, metrics.disk(), metrics.diskWarning()))
      .append(color(&quot;&#x2502;&quot;, CYAN)).append(&quot;\n&quot;);

    sb.append(color(&quot;&#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;&quot;, CYAN)).append(&quot;\n&quot;);

    return sb.toString();
};

private static String gauge(String label, double percent, boolean warning) {
    int filled = (int) ((20 * percent) / 100);
    int empty = 20 - filled;

    String barColor = warning ? RED : GREEN;
    String warnIcon = warning ? color(&quot; &#x26a0;&quot;, YELLOW) : &quot;  &quot;;

    return &quot; &quot; + color(label, BOLD) + &quot; &quot; +
        color(&quot;[&quot;, DIM) +
        color(&quot;&#x2588;&quot;.repeat(filled), barColor) +
        color(&quot;&#x2591;&quot;.repeat(empty), BRIGHT_BLACK) +
        color(&quot;]&quot;, DIM) +
        color(String.format(&quot; %3.0f%%&quot;, percent), warning ? RED : WHITE) +
        warnIcon + &quot; &quot;;
}
</code></pre></div>
<p>Output:</p>

<div class="verbatim">
<pre><code>&#x250c;&#x2500; System Monitor &#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;
&#x2502; CPU  [&#x2588;&#x2588;&#x2588;&#x2588;&#x2588;&#x2588;&#x2588;&#x2588;&#x2591;&#x2591;&#x2591;&#x2591;&#x2591;&#x2591;&#x2591;&#x2591;&#x2591;&#x2591;&#x2591;&#x2591;] 67%  &#x2502;
&#x2502; MEM  [&#x2588;&#x2588;&#x2588;&#x2588;&#x2588;&#x2588;&#x2588;&#x2588;&#x2588;&#x2588;&#x2591;&#x2591;&#x2591;&#x2591;&#x2591;&#x2591;&#x2591;&#x2591;&#x2591;&#x2591;] 52%  &#x2502;
&#x2502; DISK [&#x2588;&#x2588;&#x2588;&#x2588;&#x2588;&#x2588;&#x2588;&#x2588;&#x2588;&#x2588;&#x2588;&#x2588;&#x2588;&#x2588;&#x2588;&#x2588;&#x2588;&#x2588;&#x2591;&#x2591;] 91% &#x26a0;&#x2502;
&#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;
</code></pre></div></section><section>
<h3>CLI Adapter - Plain Text</h3>

<div class="verbatim">
<pre><code class="language-java">public static final Function&lt;SystemMetrics, String&gt; CLI_ADAPTER = metrics -&gt;
    String.format(&quot;cpu: %.0f%%\nmem: %.0f%%\ndisk: %.0f%%\n&quot;,
        metrics.cpu(), metrics.memory(), metrics.disk());
</code></pre></div>
<p>Output:</p>

<div class="verbatim">
<pre><code>cpu: 67%
mem: 52%
disk: 91%
</code></pre></div></section><section>
<h3>JSON Adapter - Machine Readable</h3>

<div class="verbatim">
<pre><code class="language-java">public static final Function&lt;SystemMetrics, String&gt; JSON_ADAPTER = metrics -&gt; {
    StringBuilder warnings = new StringBuilder(&quot;[&quot;);
    boolean first = true;
    if (metrics.cpuWarning()) { warnings.append(&quot;\&quot;cpu\&quot;&quot;); first = false; }
    if (metrics.memoryWarning()) {
        if (!first) warnings.append(&quot;, &quot;);
        warnings.append(&quot;\&quot;memory\&quot;&quot;);
        first = false;
    }
    if (metrics.diskWarning()) {
        if (!first) warnings.append(&quot;, &quot;);
        warnings.append(&quot;\&quot;disk\&quot;&quot;);
    }
    warnings.append(&quot;]&quot;);

    return String.format(
        &quot;{\n  \&quot;cpu\&quot;: %.1f,\n  \&quot;memory\&quot;: %.1f,\n  \&quot;disk\&quot;: %.1f,\n  \&quot;warnings\&quot;: %s\n}\n&quot;,
        metrics.cpu(), metrics.memory(), metrics.disk(), warnings
    );
};
</code></pre></div>
<p>Output:</p>

<div class="verbatim">
<pre><code class="language-json">{
  &quot;cpu&quot;: 67.0,
  &quot;memory&quot;: 52.0,
  &quot;disk&quot;: 91.0,
  &quot;warnings&quot;: [&quot;disk&quot;]
}
</code></pre></div></section><section>
<h3>Prometheus Adapter - Metrics Format</h3>

<div class="verbatim">
<pre><code class="language-java">public static final Function&lt;SystemMetrics, String&gt; PROMETHEUS_ADAPTER = metrics -&gt; {
    StringBuilder sb = new StringBuilder();

    sb.append(&quot;# HELP system_cpu_percent Current CPU usage percentage\n&quot;);
    sb.append(&quot;# TYPE system_cpu_percent gauge\n&quot;);
    sb.append(String.format(&quot;system_cpu_percent %.1f\n&quot;, metrics.cpu()));

    sb.append(&quot;# HELP system_memory_percent Current memory usage percentage\n&quot;);
    sb.append(&quot;# TYPE system_memory_percent gauge\n&quot;);
    sb.append(String.format(&quot;system_memory_percent %.1f\n&quot;, metrics.memory()));

    sb.append(&quot;# HELP system_disk_percent Current disk usage percentage\n&quot;);
    sb.append(&quot;# TYPE system_disk_percent gauge\n&quot;);
    sb.append(String.format(&quot;system_disk_percent %.1f\n&quot;, metrics.disk()));

    return sb.toString();
};
</code></pre></div>
<p>Output:</p>

<div class="verbatim">
<pre><code># HELP system_cpu_percent Current CPU usage percentage
# TYPE system_cpu_percent gauge
system_cpu_percent 67.0
# HELP system_memory_percent Current memory usage percentage
# TYPE system_memory_percent gauge
system_memory_percent 52.0
# HELP system_disk_percent Current disk usage percentage
# TYPE system_disk_percent gauge
system_disk_percent 91.0
</code></pre></div><hr /></section></section><section>
<h2>Part 4: The Output Port</h2>
<p>The domain needs metrics from somewhere. Define an output port:</p>

<div class="verbatim">
<pre><code class="language-java">public interface MetricsProvider {

    double getCpuUsage();

    double getMemoryUsage();

    double getDiskUsage();

    default SystemMetrics getAllMetrics() {
        return new SystemMetrics(getCpuUsage(), getMemoryUsage(), getDiskUsage());
    }
}
</code></pre></div>
<p>This is a <strong>driven port</strong> - the application core calls out through this interface.
Implementations can read from the real OS, return mock data, or fetch remotely.</p><hr /></section><section>
<h2>Part 5: Use Case Handlers</h2>
<p>Handlers connect use cases to ports using <code>UseCaseHandler</code>:</p>

<div class="verbatim">
<pre><code class="language-java">public static class GetAllMetricsHandler extends UseCaseHandler&lt;Void, SystemMetrics&gt; {

    public GetAllMetricsHandler(HexaApp app) {
        super(app);
    }

    @Override
    public SystemMetrics apply(Void input) {
        return port(MetricsProvider.class).getAllMetrics();
    }
}
</code></pre></div>
<p>The <code>UseCaseHandler</code> base class provides:</p>
<ul>

<li>Access to the port registry via <code>port(Class&lt;T&gt;)</code></li>
<li>Clean separation between orchestration and infrastructure</li>
</ul><hr /></section><section>
<h2>Part 6: Wiring It Together</h2>
<p>Now wire use cases and adapters into a <code>HexaApp</code>:</p>

<div class="verbatim">
<pre><code class="language-java">public final class SysmonApp {

    public static HexaApp createApp(MetricsProvider provider) {
        HexaApp app = HexaApp.create().port(MetricsProvider.class, provider);

        // Register use case handlers
        app.withUseCase(GET_CPU, new GetCpuHandler(app))
           .withUseCase(GET_MEMORY, new GetMemoryHandler(app))
           .withUseCase(GET_DISK, new GetDiskHandler(app))
           .withUseCase(GET_ALL, new GetAllMetricsHandler(app));

        // Register output adapters
        app.withAdapter(TO_TUI, TUI_ADAPTER)
           .withAdapter(TO_CLI, CLI_ADAPTER)
           .withAdapter(TO_JSON, JSON_ADAPTER)
           .withAdapter(TO_PROMETHEUS, PROMETHEUS_ADAPTER);

        return app;
    }
}
</code></pre></div>
<p>Key patterns:</p>
<ul>

<li><strong>Port registration</strong> - <code>provider</code> injected via <code>.port()</code></li>
<li><strong>Use case registration</strong> - Handlers wired with <code>.withUseCase()</code></li>
<li><strong>Adapter registration</strong> - Formatters wired with <code>.withAdapter()</code></li>
</ul><hr /></section><section>
<h2>Part 7: Using Adapters</h2>
<p>Invoke adapters with type-safe keys:</p>

<div class="verbatim">
<pre><code class="language-java">// Get domain data
SystemMetrics metrics = app.invoke(GET_ALL, null);

// Transform to different formats
String tui = app.adapt(TO_TUI, metrics);
String cli = app.adapt(TO_CLI, metrics);
String json = app.adapt(TO_JSON, metrics);
String prometheus = app.adapt(TO_PROMETHEUS, metrics);
</code></pre></div>
<p>Or chain them in one flow:</p>

<div class="verbatim">
<pre><code class="language-java">// Invoke use case and adapt in sequence
SystemMetrics metrics = app.invoke(GET_ALL, null);
String output = app.adapt(currentFormat, metrics);
System.out.print(output);
</code></pre></div><hr /></section><section>
<h2>Part 8: The TUI (Driving Adapter)</h2>
<p>The TUI is a <strong>driving adapter</strong> - it drives the application from user input:</p>

<div class="verbatim">
<pre><code class="language-java">public class SysmonTUI {

    private final HexaApp app;

    public SysmonTUI() {
        this.app = SysmonApp.createApp(new OshiMetricsProvider());
    }

    public void run() {
        SysmonState state = SysmonState.initial(app);

        while (state.running()) {
            render(state);
            int key = readKeyWithTimeout(2000);

            if (key == -1) {
                state = state.refresh();  // Auto-refresh on timeout
            } else {
                state = processKey(state, key);
            }
        }
    }

    private SysmonState processKey(SysmonState state, int key) {
        return switch (Character.toLowerCase((char) key)) {
            case 'q', 3 -&gt; state.stop();
            case '1' -&gt; state.withFormat(SysmonFormat.TUI);
            case '2' -&gt; state.withFormat(SysmonFormat.CLI);
            case '3' -&gt; state.withFormat(SysmonFormat.JSON);
            case '4' -&gt; state.withFormat(SysmonFormat.PROMETHEUS);
            case 'r', ' ', '\n' -&gt; state.refresh();
            default -&gt; state;
        };
    }
}
</code></pre></div>
<p>The TUI:</p>
<ul>

<li>Creates the app with a real metrics provider</li>
<li>Manages immutable state for the current format</li>
<li>Switches adapters based on user input (1-4 keys)</li>
<li>Auto-refreshes every 2 seconds</li>
</ul><hr /></section><section>
<h2>Part 9: Adding New Adapters</h2>
<p>Need XML output? Add an adapter without touching existing code:</p>

<div class="verbatim">
<pre><code class="language-java">// 1. Define the key
public static final AdapterKey&lt;SystemMetrics, String&gt; TO_XML =
    AdapterKey.of(&quot;toXml&quot;);

// 2. Implement the adapter
public static final Function&lt;SystemMetrics, String&gt; XML_ADAPTER = metrics -&gt;
    String.format(&quot;&quot;&quot;
        &lt;?xml version=&quot;1.0&quot;?&gt;
        &lt;metrics&gt;
          &lt;cpu&gt;%.1f&lt;/cpu&gt;
          &lt;memory&gt;%.1f&lt;/memory&gt;
          &lt;disk&gt;%.1f&lt;/disk&gt;
        &lt;/metrics&gt;
        &quot;&quot;&quot;,
        metrics.cpu(), metrics.memory(), metrics.disk()
    );

// 3. Register it
app.withAdapter(TO_XML, XML_ADAPTER);

// 4. Use it
String xml = app.adapt(TO_XML, metrics);
</code></pre></div>
<p>No changes to:</p>
<ul>

<li>Domain model (<code>SystemMetrics</code>)</li>
<li>Use cases (handlers)</li>
<li>Existing adapters</li>
<li>The TUI (just add case &#x2018;5&#x2019; for XML)</li>
</ul><hr /></section><section>
<h2>Architecture Summary</h2>

<div class="verbatim">
<pre><code>&#x250c;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;
&#x2502;                      DRIVING ADAPTERS                           &#x2502;
&#x2502;  &#x250c;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;  &#x250c;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;  &#x250c;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;           &#x2502;
&#x2502;  &#x2502;   TUI (1-4)  &#x2502;  &#x2502;   REST API   &#x2502;  &#x2502;   CLI Args   &#x2502;           &#x2502;
&#x2502;  &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x252c;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;  &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x252c;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;  &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x252c;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;           &#x2502;
&#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x253c;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x253c;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x253c;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;
          &#x2502;                 &#x2502;                 &#x2502;
          &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x25ba;&#x2502;&#x25c4;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;
                            &#x2502;
&#x250c;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x25bc;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;
&#x2502;                     SysmonApp (HexaApp)                         &#x2502;
&#x2502;  &#x250c;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510; &#x2502;
&#x2502;  &#x2502;                     USE CASES                              &#x2502; &#x2502;
&#x2502;  &#x2502;  &#x250c;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510; &#x250c;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510; &#x250c;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510; &#x250c;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;           &#x2502; &#x2502;
&#x2502;  &#x2502;  &#x2502; GET_CPU &#x2502; &#x2502; GET_MEM &#x2502; &#x2502;GET_DISK &#x2502; &#x2502; GET_ALL &#x2502;           &#x2502; &#x2502;
&#x2502;  &#x2502;  &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x252c;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518; &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x252c;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518; &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x252c;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518; &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x252c;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;           &#x2502; &#x2502;
&#x2502;  &#x2502;       &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2534;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2534;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;                &#x2502; &#x2502;
&#x2502;  &#x2502;                       &#x2502;                                    &#x2502; &#x2502;
&#x2502;  &#x2502;             &#x250c;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x25bc;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;                          &#x2502; &#x2502;
&#x2502;  &#x2502;             &#x2502;  SystemMetrics    &#x2502;                          &#x2502; &#x2502;
&#x2502;  &#x2502;             &#x2502;  (Domain Model)   &#x2502;                          &#x2502; &#x2502;
&#x2502;  &#x2502;             &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x252c;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;                          &#x2502; &#x2502;
&#x2502;  &#x2502;                       &#x2502;                                    &#x2502; &#x2502;
&#x2502;  &#x2502;  &#x250c;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x25bc;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;               &#x2502; &#x2502;
&#x2502;  &#x2502;  &#x2502;            OUTPUT ADAPTERS              &#x2502;               &#x2502; &#x2502;
&#x2502;  &#x2502;  &#x2502;  &#x250c;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510; &#x250c;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510; &#x250c;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510; &#x250c;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;  &#x2502;               &#x2502; &#x2502;
&#x2502;  &#x2502;  &#x2502;  &#x2502; TUI  &#x2502; &#x2502; CLI  &#x2502; &#x2502; JSON &#x2502; &#x2502;PROMETH &#x2502;  &#x2502;               &#x2502; &#x2502;
&#x2502;  &#x2502;  &#x2502;  &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518; &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518; &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518; &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;  &#x2502;               &#x2502; &#x2502;
&#x2502;  &#x2502;  &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;               &#x2502; &#x2502;
&#x2502;  &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518; &#x2502;
&#x2502;                            &#x2502;                                    &#x2502;
&#x2502;                   Output Port Interface                         &#x2502;
&#x2502;                   (MetricsProvider)                             &#x2502;
&#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x253c;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;
                             &#x2502;
&#x250c;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x25bc;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;
&#x2502;                     DRIVEN ADAPTERS                             &#x2502;
&#x2502;  &#x250c;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;  &#x250c;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;  &#x250c;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;           &#x2502;
&#x2502;  &#x2502;OshiMetrics   &#x2502;  &#x2502; MockMetrics  &#x2502;  &#x2502;RemoteMetrics &#x2502;           &#x2502;
&#x2502;  &#x2502;(cross-plat)  &#x2502;  &#x2502; (Testing)    &#x2502;  &#x2502; (HTTP API)   &#x2502;           &#x2502;
&#x2502;  &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;  &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;  &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;           &#x2502;
&#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;
</code></pre></div><hr /></section><section>
<h2>Key Takeaways</h2>
<ol style="list-style-type: decimal;">

<li><strong>Adapters are pure functions</strong> - <code>Function&lt;I, O&gt;</code> with no side effects</li>
<li><strong>Type-safe keys</strong> - <code>AdapterKey&lt;I, O&gt;</code> prevents runtime type errors</li>
<li><strong>Domain stays clean</strong> - No formatting logic in <code>SystemMetrics</code></li>
<li><strong>Open for extension</strong> - Add adapters without modifying existing code</li>
<li><strong>Testable</strong> - Adapters are trivial to unit test (input &#x2192; expected output)</li>
<li><strong>Composable</strong> - Chain <code>invoke()</code> and <code>adapt()</code> for clean data flows</li>
</ol><hr /></section><section>
<h2>Running the Example</h2>

<div class="verbatim">
<pre><code class="language-bash"># From the hexafun-examples directory
mvn compile exec:java -Dexec.mainClass=&quot;com.guinetik.hexafun.examples.sysmon.SysmonTUI&quot;
</code></pre></div>
<p>Press 1-4 to switch formats, &#x2018;r&#x2019; to refresh, &#x2018;q&#x2019; to quit.</p><hr /></section><section>
<h2>Next Steps</h2>
<ul>

<li>Read the <a href="tutorial.html">Tutorial</a> for a complete CRUD application</li>
<li>Explore the <a href="fluent.html">Fluent DSL</a> for use case composition</li>
<li>Check the <a href="apidocs/index.html">Javadoc</a> for API details</li>
</ul></section></section>
        </main>
    </div>
    <hr/>
    <footer>
      <div class="container">
        <div class="row">
            <p>©      2025
</p>
        </div>
        <p id="poweredBy" class="pull-right"><a href="https://maven.apache.org/" class="builtBy" target="_blank"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
</p>
      </div>
    </footer>
<script>
  if(anchors) {
    anchors.add();
  }
</script>
  </body>
</html>
